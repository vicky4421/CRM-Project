<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>VismijaTech</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
  </head>
  <body>
    <!--header starts here-->
    <div th:if="${sessionUser == null OR sessionUser == ''}">
      <div th:replace="~{fragments/header :: crm-header}"></div>
    </div>
    <div th:unless="${sessionUser == null OR sessionUser == ''}">
      <div th:replace="~{fragments/user-header :: u-header}"></div>
    </div>
    <!--header end here-->

    <!-- main starts here -->
    <main class="container-fluid">
      <!-- banner starts here -->
      <section>
        <img
          src="/assets/banner.jpg"
          alt="banner"
          width="100%"
          height="300px"
        />
      </section>
      <!-- banner ends here -->

      <!-- course section starts here -->
      <section class="container py-5 bg-light">
        <h3 class="text-center mb-4">Our Courses</h3>

        <!-- Row -->
        <div class="row g-4">
          <!-- courses starts here  -->
          <div
            th:each="course : ${courseList}"
            class="col-lg-3 col-md-6"
          >
            <div class="card" style="width: 18rem">
<!--              <img th:src="${course.imageUrl}" class="card-img-top" alt="..."  /> this also works   -->
              <img th:src="@{${course.imageUrl}}" class="card-img-top" alt="..." style="width: 17rem; height: 10rem;"  />
              <div class="card-body">
                <h5 class="card-title" th:text="${course.name}" ></h5>
                <p class="card-text" th:text="${course.description}" ></p>
                <p>
                  <strong>Price: </strong> <del>Rs.<span th:text="${course.originalPrice}" ></span></del>
                  <span class="bg-light p-1">Rs.<span th:text="${course.discountedPrice}" ></span></span>
                </p>
                <!--                        bordered button if user not logged in-->
                <div th:if="${sessionUser == null OR sessionUser == ''}">
                  <a href="login" class="btn btn-outline-primary"
                    >Login to buy</a
                  >
                </div>
                <div th:unless="${sessionUser == null OR sessionUser == ''}">
                  <button class="btn btn-primary"
                          th:data-cname="${course.name}"
                          th:data-cemail="${sessionUser.email}"
                          onclick="paymentGateway(this.getAttribute('data-cname'), this.getAttribute('data-cemail'))" >Buy</button>
                </div>
              </div>
              <div class="card-footer text-body-secondary">
                <span th:text="${course.updatedOn}"></span>
              </div>
            </div>
          </div>
          <!-- courses ends here  -->
        </div>
      </section>
      <!-- course section ends here -->
    </main>
    <!-- main ends here -->

    <!-- footer starts here -->
    <div th:replace="~{fragments/footer :: crm-footer}"></div>

    <!-- bootstrap js -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script>
        function paymentGateway(courseName, userEmail){
            alert("payment gateway doesn't implemented due to KYC");

            var requestData = {
                courseName: courseName,
                userEmail: userEmail,
                dateOfPurchase: new Date().toLocaleString(),
            };

            $.ajax({
                type: "POST",
                url: "/api/storeOrderDetails",
                contentType: "application/json",
                data: JSON.stringify(requestData),
                success: function(response){
                    alert(response);
                    window.location.href="/myCourses";
                },
                error: function(error){
                    alert(error);
                },
            });
        }
    </script>
  </body>
</html>
